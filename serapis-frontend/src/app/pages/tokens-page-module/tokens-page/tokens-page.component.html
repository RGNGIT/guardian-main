<ng-template class="loading" #async>
  <async-progress
    [fullPage]="true"
    class="loading-progress" [taskId]="taskId"
    [expected]="expectedTaskMessages"
    (error)="onAsyncError($event)"
    (completed)="onAsyncCompleted()">
  </async-progress>
</ng-template>

<ng-container *ngIf="!(asyncProcess || taskId); else async" >
  <div *appIsRoleAllowDirective="{role: 'STANDARD_REGISTRY'};">
    <div class="buttons flex-row flex-align-center justify-between">
      <app-serapis-button type="filled" title="Add New Token" (click)="openDialog(addNewToken)">
        <mat-icon>add</mat-icon>
      </app-serapis-button>
      <mat-form-field appearance="standard" style="margin-right: 24px">
        <mat-label>Policy</mat-label>
        <mat-select [(value)]="currentPolicy" (selectionChange)="onFilter()">
          <mat-option value="">All policies</mat-option>
          <mat-option *ngFor="let policy of policies" [value]="policy.id">
            <span>{{policy.name}}</span>
            <span> ({{policy.id}})</span>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <app-data-grid [data]="dataSR">
        <ng-template #tokenIdCellTempl let-element="element">
          <div class="flex-row flex-align-center token-id">
            <div class="id-cell">{{element.tokenId}}</div>
            <a [href]="tokenUrl + element.tokenId" target="_blank">
              <div class="flex-row flex-align-center hedera-link">
                <span>Open In Hedera</span>
                <mat-icon
                  class="icons"
                  svgIcon="linkHedera"
                  aria-hidden="false"></mat-icon>
              </div>
            </a>
          </div>
        </ng-template>
        <ng-template #actionsCellTempl let-element="element">
          <div class="flex-row flex-align-center hedera-link" style="margin-left: 0" [routerLink]="element.tokenId">
            <mat-icon
              style="margin-left: 0"
              class="icons"
              svgIcon="peoples"
              aria-hidden="false"></mat-icon>
            <span style="margin-left: 10px">View</span>
          </div>
        </ng-template>
      </app-data-grid>
    </div>
  </div>
  <div *appIsRoleAllowDirective="{role: 'USER'}" >
    <app-data-grid [data]="dataSR">
      <ng-template #assocCell let-element="element">
        <div class="flex-row flex-align-center">
          <ng-container
            [ngTemplateOutlet]="yesNoNa"
            [ngTemplateOutletContext]="{element: element.associated}"
          ></ng-container>
          <span class="link-button">
            <ng-template #associate>To Associate</ng-template>
            <mat-icon
              [appTooltip]="associate"
              *ngIf="!element.associated"
              (click)="associateHandler(element, true)"
            >
              link
            </mat-icon>
            <ng-template #disAssociate>To Disassociate</ng-template>
            <mat-icon
              [appTooltip]="disAssociate"
              *ngIf="element.associated"
              (click)="associateHandler(element, false)"
            >
              link_off
            </mat-icon>
          </span>
        </div>
      </ng-template>
      <ng-template #kycCell let-element="element">
        <ng-container
          [ngTemplateOutlet]="yesNoNa"
          [ngTemplateOutletContext]="{element: element.kyc}"
        ></ng-container>
      </ng-template>
      <ng-template #frozenCell let-element="element">
        <ng-container
          [ngTemplateOutlet]="yesNoNa"
          [ngTemplateOutletContext]="{element: element.frozen}"
        ></ng-container>
      </ng-template>
    </app-data-grid>
  </div>
</ng-container>

<ng-template #yesNoNa let-element="element">
  <div [ngSwitch]="element" class="yes-no-block" [class.yes]="element === true" [class.no]="element === false">
    <span *ngSwitchCase="true">Yes</span>
    <span *ngSwitchCase="false">No</span>
    <span *ngSwitchDefault>n/a</span>
  </div>
</ng-template>

<ng-template #addNewToken>
  <app-base-dialog>
    <div header>New Token</div>
    <div body class="body">
      <form [formGroup]="dataForm">
        <mat-form-field class="full-width" appearance="standard">
          <mat-label>TOKEN NAME:</mat-label>
          <input matInput type="text" placeholder="Token Name" formControlName="tokenName">
        </mat-form-field>

        <mat-form-field class="full-width" appearance="standard">
          <mat-label>TOKEN SYMBOL:</mat-label>
          <input matInput type="text" placeholder="F" formControlName="tokenSymbol">
        </mat-form-field>

        <mat-form-field class="half-width" appearance="standard" style="padding-right: 10px">
          <mat-label>TOKEN TYPE</mat-label>
          <mat-select formControlName="tokenType" (selectionChange)="onChangeType()">
            <mat-option value="fungible">Fungible</mat-option>
            <mat-option value="non-fungible">Non-Fungible</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field *ngIf="ft" class="half-width" style="padding-left: 10px" appearance="standard">
          <mat-label>DECIMALS:</mat-label>
          <input matInput type="text" placeholder="2" formControlName="decimals">
        </mat-form-field>

        <div class="flex-row checkboxes">
          <div class="half-width">
            <div class="checkbox"><mat-checkbox class="example-margin" color="primary" formControlName="enableAdmin">Enable Admin</mat-checkbox></div>
            <div  class="checkbox"><mat-checkbox class="example-margin" color="primary" formControlName="changeSupply">Change Supply</mat-checkbox></div>
            <div  class="checkbox"><mat-checkbox class="example-margin" color="primary" formControlName="enableFreeze">Enable Freeze</mat-checkbox></div>
          </div>
          <div class="half-width" style="padding-left: 10px">
            <div  class="checkbox"><mat-checkbox class="example-margin" color="primary" formControlName="enableKYC">Enable KYC</mat-checkbox></div>
            <div  class="checkbox"><mat-checkbox class="example-margin" color="primary" formControlName="enableWipe">Enable Wipe</mat-checkbox></div>
          </div>
        </div>
      </form>
    </div>
    <div footer>
      <div class="footer">
        <app-serapis-button type="empty" title="Cancel" (click)="closeDialog()">
        </app-serapis-button>
        <app-serapis-button  type="filled" title="Save" (click)="createToken()" [disabled]="!dataForm.valid">
        </app-serapis-button>
      </div>
    </div>
  </app-base-dialog>
</ng-template>
